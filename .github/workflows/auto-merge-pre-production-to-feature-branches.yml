name: Auto-merge Pre-production to Feature, Hotfix, and Bugfix Branches
on:
  push:
    branches:
      - pre-production

jobs:
  merge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Git
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"

      - name: Fetch branches
        run: |
          git fetch --all

      - name: Merge pre-production into Feature, Hotfix, and Bugfix branches
        run: |
          for branch in $(git branch -r | grep -E 'origin/(feature|bugfix|hotfix)/'); do
            branch_name=${branch#origin/}
            git checkout $branch_name
            git merge pre-production --no-edit
            git push origin $branch_name
          done
